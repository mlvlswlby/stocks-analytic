<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stocks Analytic</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/static/style.css">
    <!-- Favicon: Chart Icon -->
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“ˆ</text></svg>">
    <style>
        .suggestions-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 0.75rem;
            margin-top: 0.5rem;
            z-index: 100;
            max-height: 300px;
            overflow-y: auto;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }

        .suggestion-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            justify-content: space-between;
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(30, 30, 30, 0.5);
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(100, 116, 139, 0.5);
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 116, 139, 0.8);
        }

        .suggestion-item:hover {
            background: #334155;
        }

        /* Ticker Animation */
        .ticker-wrap {
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
        }

        .ticker {
            display: inline-block;
            white-space: nowrap;
            /* Speed logic must account for width; 30s is a decent ballpark */
            animation: scroll 30s linear infinite;
        }

        .ticker:hover {
            animation-play-state: paused;
        }

        @keyframes scroll {
            0% {
                transform: translateX(100%);
            }

            100% {
                transform: translateX(-100%);
            }
        }
    </style>
</head>

<body class="bg-slate-900 text-slate-100 min-h-screen">
    <div id="app" class="container mx-auto p-4 max-w-7xl">

        <!-- TOP TICKER: IDX -->
        <div
            class="fixed top-0 left-0 right-0 z-50 bg-slate-900 border-b border-slate-800 h-10 overflow-hidden flex items-center">
            <div class="ticker-wrap w-full">
                <div class="ticker h-full flex items-center">
                    <div v-for="stock in marketData.idx" :key="stock.symbol"
                        class="ticker-item flex items-center gap-2 px-6 border-r border-slate-800">
                        <span class="font-bold text-slate-200 text-sm">{{ stock.symbol }}</span>
                        <span class="font-mono text-xs font-bold"
                            :class="stock.pchange >= 0 ? 'text-emerald-400' : 'text-rose-400'">
                            {{ stock.pchange >= 0 ? 'â–²' : 'â–¼' }} {{ Math.abs(stock.pchange).toFixed(2) }}%
                        </span>
                    </div>
                    <!-- Duplicate for seamless loop if needed, but CSS handles it -->
                    <div v-for="stock in marketData.idx" :key="'dup'+stock.symbol"
                        class="ticker-item flex items-center gap-2 px-6 border-r border-slate-800">
                        <span class="font-bold text-slate-200 text-sm">{{ stock.symbol }}</span>
                        <span class="font-mono text-xs font-bold"
                            :class="stock.pchange >= 0 ? 'text-emerald-400' : 'text-rose-400'">
                            {{ stock.pchange >= 0 ? 'â–²' : 'â–¼' }} {{ Math.abs(stock.pchange).toFixed(2) }}%
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- SEARCH HERO (Google Style) -->
        <div v-if="!currentStock"
            class="min-h-screen flex flex-col items-center justify-center -mt-20 animate-fade-in relative z-10 px-4">
            <!-- Background Glow -->
            <div
                class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] bg-blue-500/10 blur-[120px] rounded-full pointer-events-none">
            </div>

            <div class="mb-10 text-center">
                <h1
                    class="text-6xl md:text-8xl font-black bg-clip-text text-transparent bg-gradient-to-r from-blue-400 via-teal-400 to-emerald-400 tracking-tighter mb-4 pb-2">
                    Stocks Analytic
                </h1>
                <p class="text-slate-400 text-lg md:text-xl font-medium tracking-wide">Global Market Intelligence</p>
            </div>

            <div class="w-full max-w-2xl relative">
                <form @submit.prevent="handleSearch" class="relative z-50">
                    <div class="relative group">
                        <!-- Input -->
                        <input type="text" v-model="searchQuery" @input="onSearchInput"
                            placeholder="Search any ticker (e.g. BBCA, NVDA, GOTO)..."
                            class="w-full bg-slate-800/80 backdrop-blur border border-slate-700/50 rounded-full py-5 px-8 pl-14 text-xl shadow-2xl focus:outline-none focus:border-blue-500/50 focus:ring-4 focus:ring-blue-500/10 transition-all">

                        <!-- Search Icon -->
                        <i
                            class="fa-solid fa-search absolute left-6 top-1/2 -translate-y-1/2 text-slate-500 text-xl group-focus-within:text-blue-400 transition-colors"></i>

                        <!-- Loading Spinner in Input -->
                        <i v-if="loadingSearch"
                            class="fa-solid fa-circle-notch fa-spin absolute right-6 top-1/2 -translate-y-1/2 text-blue-500 text-xl"></i>
                    </div>
                </form>

                <!-- AutoComplete Dropdown -->
                <div v-if="showSuggestions || (loadingSearch && searchQuery)"
                    class="absolute top-full left-0 right-0 mt-4 bg-slate-800/90 backdrop-blur-xl border border-slate-700 rounded-2xl shadow-2xl overflow-y-auto max-h-[400px] custom-scrollbar z-50 animate-slide-up">
                    <div v-if="loadingSearch" class="p-8 text-center text-slate-400">
                        <i class="fas fa-circle-notch fa-spin text-2xl text-blue-500 mb-2"></i>
                        <p class="text-xs font-medium animate-pulse">Scanning market...</p>
                    </div>
                    <div v-else>
                        <ul class="divide-y divide-slate-700/50">
                            <li v-for="(result, index) in searchResults" :key="index"
                                @click="selectSuggestion(result.symbol)"
                                class="p-4 hover:bg-slate-700/50 cursor-pointer transition-colors group">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div
                                            class="w-10 h-10 rounded-lg bg-slate-700 group-hover:bg-slate-600 flex items-center justify-center transition-colors">
                                            <span class="text-sm font-bold text-slate-300 group-hover:text-white">{{
                                                result.symbol.slice(0, 1) }}</span>
                                        </div>
                                        <div>
                                            <div class="flex items-center gap-2">
                                                <span class="font-bold text-blue-400 group-hover:text-blue-300">{{
                                                    result.symbol }}</span>
                                                <template v-if="result.exchange">
                                                    <span
                                                        class="text-xs font-bold px-1.5 py-0.5 rounded text-slate-400 bg-slate-800 border border-slate-600"
                                                        style="font-size: 0.65rem;">
                                                        {{ result.exchange }}
                                                    </span>
                                                </template>
                                            </div>
                                            <div
                                                class="text-sm text-slate-400 group-hover:text-slate-300 truncate max-w-[200px]">
                                                {{ result.name }}</div>
                                        </div>
                                    </div>
                                    <i
                                        class="fas fa-chevron-right text-slate-600 group-hover:text-white transition-colors"></i>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Trade Simulator -->
            <div class="max-w-xl mx-auto mt-6">
                <button @click="showTradeSim = !showTradeSim"
                    class="flex items-center justify-center w-full gap-2 text-sm font-medium text-slate-400 hover:text-white transition-colors mb-4">
                    <i class="fas fa-calculator"></i>
                    Analyze My Position
                    <i :class="showTradeSim ? 'rotate-180' : ''"
                        class="fas fa-chevron-down transition-transform duration-200"></i>
                </button>

                <div v-show="showTradeSim"
                    class="bg-slate-800/50 backdrop-blur-md border border-slate-700 rounded-2xl p-6 animate-slide-up">
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div class="col-span-2 sm:col-span-1">
                            <label class="block text-xs font-medium text-slate-400 mb-1">Stock Ticker</label>
                            <input v-model="tradeSimTicker" type="text" placeholder="e.g. BBCA.JK"
                                class="w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all text-sm font-semibold uppercase">
                        </div>
                        <div class="col-span-2 sm:col-span-1">
                            <label class="block text-xs font-medium text-slate-400 mb-1">Avg Price</label>
                            <input v-model.number="tradeSimPrice" type="number" placeholder="0"
                                class="w-full bg-slate-900 border border-slate-700 rounded-xl px-4 py-2.5 text-white placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all text-sm font-semibold">
                        </div>
                    </div>
                    <button @click="analyzeTrade" :disabled="loadingTradeSim || !tradeSimTicker || !tradeSimPrice"
                        class="w-full bg-blue-600 hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed text-white font-bold py-2.5 rounded-xl transition-all shadow-lg shadow-blue-500/20 mb-4">
                        <span v-if="loadingTradeSim"><i class="fas fa-circle-notch fa-spin mr-2"></i>Analyzing...</span>
                        <span v-else>Calculate Plan</span>
                    </button>

                    <!-- Result -->
                    <div v-if="tradePlan" class="bg-slate-900/50 rounded-xl p-4 border border-slate-700/50">
                        <div class="flex items-center justify-between mb-2">
                            <div class="text-xs font-bold text-slate-500 uppercase tracking-wider">Current Price</div>
                            <div class="text-sm font-bold text-white">{{ formatNumber(tradePlan.current_price) }}</div>
                        </div>
                        <div class="flex items-center justify-between mb-4">
                            <div class="text-sm font-medium text-slate-400">P/L Estimation</div>
                            <div :class="tradePlan.pl_pct >= 0 ? 'text-emerald-400' : 'text-rose-400'"
                                class="text-lg font-black">
                                {{ tradePlan.pl_pct >= 0 ? '+' : '' }}{{ tradePlan.pl_pct.toFixed(2) }}%
                            </div>
                        </div>

                        <div class="mb-4">
                            <div class="text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Recommendation
                            </div>
                            <div class="bg-slate-800 rounded-lg p-3 border-l-4" :class="{
                                'border-emerald-500': tradePlan.action.includes('HOLD') || tradePlan.action.includes('AVERAGE') || tradePlan.action.includes('ADD'),
                                'border-amber-500': tradePlan.action.includes('TAKE') || tradePlan.action.includes('TRAILING'),
                                'border-rose-500': tradePlan.action.includes('CUT') || tradePlan.action.includes('SELL')
                            }">
                                <div class="text-base font-black text-white mb-1">{{ tradePlan.action }}</div>
                                <div class="text-xs text-slate-400">{{ tradePlan.reason }}</div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-3 text-sm">
                            <div class="bg-slate-800 rounded-lg p-3">
                                <div class="text-xs text-slate-500 mb-1">Take Profit</div>
                                <div class="font-mono font-bold text-emerald-400">{{ formatNumber(tradePlan.targets.tp1)
                                    }}</div>
                            </div>
                            <div class="bg-slate-800 rounded-lg p-3">
                                <div class="text-xs text-slate-500 mb-1">Cut Loss</div>
                                <div class="font-mono font-bold text-rose-400">{{ formatNumber(tradePlan.targets.cl) }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BOTTOM TICKER: NASDAQ -->
        <div
            class="fixed bottom-0 left-0 right-0 z-50 bg-slate-900 border-t border-slate-800 h-10 overflow-hidden flex items-center">
            <div class="ticker-wrap w-full">
                <!-- Reverse direction or slightly different speed if desired, keeping same for now -->
                <div class="ticker h-full flex items-center">
                    <div v-for="stock in marketData.nasdaq" :key="stock.symbol"
                        class="ticker-item flex items-center gap-2 px-6 border-r border-slate-800">
                        <span class="font-bold text-slate-200 text-sm">{{ stock.symbol }}</span>
                        <span class="font-mono text-xs font-bold"
                            :class="stock.pchange >= 0 ? 'text-emerald-400' : 'text-rose-400'">
                            {{ stock.pchange >= 0 ? 'â–²' : 'â–¼' }} {{ Math.abs(stock.pchange).toFixed(2) }}%
                        </span>
                    </div>
                    <div v-for="stock in marketData.nasdaq" :key="'dup'+stock.symbol"
                        class="ticker-item flex items-center gap-2 px-6 border-r border-slate-800">
                        <span class="font-bold text-slate-200 text-sm">{{ stock.symbol }}</span>
                        <span class="font-mono text-xs font-bold"
                            :class="stock.pchange >= 0 ? 'text-emerald-400' : 'text-rose-400'">
                            {{ stock.pchange >= 0 ? 'â–²' : 'â–¼' }} {{ Math.abs(stock.pchange).toFixed(2) }}%
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading Global -->
        <transition name="fade">
            <div v-if="loading"
                class="fixed inset-0 bg-slate-900/80 backdrop-blur z-50 flex items-center justify-center">
                <div class="text-center">
                    <i class="fa-solid fa-circle-notch fa-spin text-5xl text-blue-500 mb-4"></i>
                    <p class="text-slate-400 text-lg font-medium">Analyzing Market Data...</p>
                </div>
            </div>
        </transition>

        <!-- Error Global -->
        <transition name="fade">
            <div v-if="error"
                class="fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-rose-500/90 text-white px-6 py-3 rounded-full flex items-center gap-3 shadow-xl backdrop-blur">
                <i class="fa-solid fa-triangle-exclamation"></i>
                <p class="font-medium">{{ error }}</p>
                <button @click="error = null" class="ml-2 opacity-80 hover:opacity-100"><i
                        class="fa-solid fa-times"></i></button>
            </div>
        </transition>

        <!-- DETAILS VIEW (Shown when stock selected) -->
        <main v-if="stockDetails && !loading"
            class="pt-20 pb-20 animate-slide-up relative z-20 container mx-auto p-4 max-w-7xl">

            <!-- Persistent Header for Detail View -->
            <div
                class="fixed top-10 left-0 right-0 h-20 bg-slate-900/90 backdrop-blur z-40 border-b border-slate-800 flex items-center justify-between px-6 lg:px-12 animate-fade-in shadow-xl">
                <!-- Logo (Home) -->
                <div class="flex items-center gap-3 cursor-pointer group" @click="goBack">
                    <div
                        class="p-2 bg-gradient-to-br from-blue-500/20 to-teal-500/20 rounded-lg border border-blue-500/30 group-hover:border-blue-500/60 transition-colors">
                        <i class="fa-solid fa-chart-simple text-2xl text-blue-400"></i>
                    </div>
                    <div>
                        <h1
                            class="text-xl font-black bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-teal-400 tracking-tight leading-tight">
                            Stocks Analytic
                        </h1>
                        <p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Back to Home</p>
                    </div>
                </div>

                <!-- Compact Search Bar -->
                <div class="relative w-full max-w-md hidden md:block group">
                    <form @submit.prevent="handleSearch">
                        <input type="text" v-model="searchQuery" @input="onSearchInput"
                            placeholder="Search next ticker..."
                            class="w-full bg-slate-800 border-slate-700 border rounded-full py-2.5 px-6 pl-10 focus:outline-none focus:border-blue-500 transition-all text-sm shadow-inner focus:ring-2 focus:ring-blue-500/20">
                        <i
                            class="fa-solid fa-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 text-xs"></i>
                    </form>

                    <!-- Dropdown (Compact) -->
                    <div v-if="showSuggestions || (loadingSearch && searchQuery)"
                        class="absolute top-full left-0 right-0 mt-2 bg-slate-800 border border-slate-700 rounded-xl shadow-2xl overflow-y-auto max-h-[300px] custom-scrollbar z-50">
                        <div v-if="loadingSearch" class="p-4 text-center text-slate-400 text-xs">
                            <i class="fa-solid fa-circle-notch fa-spin"></i> Searching...
                        </div>
                        <div v-else-if="searchResults.length > 0">
                            <div v-for="item in searchResults" :key="item.symbol" @click="selectSuggestion(item.symbol)"
                                class="p-3 border-b border-slate-700/50 last:border-0 hover:bg-slate-700 cursor-pointer flex justify-between items-center group transition-colors">
                                <div class="flex flex-col gap-1">
                                    <span class="font-bold text-white text-sm leading-none">{{ item.symbol }}</span>
                                    <span
                                        class="text-[10px] text-slate-400 font-bold bg-slate-900 px-1.5 py-0.5 rounded w-fit">{{
                                        item.exchange || 'EQUITY' }}</span>
                                </div>
                                <div class="text-right pl-4">
                                    <span class="text-[10px] text-slate-300 font-medium truncate max-w-[150px] block">{{
                                        item.name }}</span>
                                </div>
                            </div>
                        </div>
                        <div v-else class="p-4 text-center text-slate-500 text-xs">
                            No matches.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Grid (Refactored Layout) -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-10">

                <!-- 1. Profile Card (Top Left) -->
                <div class="lg:col-span-1">
                    <div class="glass-card rounded-2xl p-6 relative overflow-hidden h-full">
                        <div class="absolute top-0 right-0 p-4 opacity-10">
                            <i class="fa-solid fa-chart-pie text-9xl"></i>
                        </div>

                        <div class="flex justify-between items-start mb-4 relative z-10">
                            <!-- Left: Text -->
                            <div>
                                <h2 class="text-4xl font-black tracking-tight flex items-center gap-3">
                                    {{ stockDetails.symbol }}
                                    <span
                                        class="px-3 py-1 rounded bg-slate-700/50 border border-slate-600/50 text-xs font-bold text-slate-400">
                                        {{ stockDetails.symbol.endsWith('.JK') ? 'IDX' : (stockDetails.exchange ===
                                        'NSDQ' ? 'NSDQ' : 'NSDQ') }}
                                    </span>
                                </h2>
                                <p class="text-slate-300 font-medium">{{ stockDetails.name }}</p>
                            </div>

                            <!-- Right: Logo (Circular & Multi-fallback) -->
                            <div class="flex-shrink-0 ml-6">
                                <!-- Try exact symbol match on TradingView, then Google Favicon as robust fallback -->
                                <img :src="`https://s3-symbol-logo.tradingview.com/${stockDetails.symbol.toLowerCase()}.svg`"
                                    class="w-32 h-32 rounded-full object-contain hover:scale-105 transition-transform duration-300 pointer-events-none select-none"
                                    alt="Logo"
                                    @error="$event.target.src = `https://t3.gstatic.com/faviconV2?client=SOCIAL&type=FAVICON&fallback_opts=TYPE,SIZE,URL&url=http://${stockDetails.domain}&size=128`">
                            </div>
                        </div>

                        <div class="text-4xl font-bold mb-6 text-blue-400 font-mono tracking-tight">
                            {{ formatNumber(stockDetails.price) }}
                        </div>

                        <div class="pt-6 border-t border-slate-700 relative z-10">
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-slate-400 font-medium">Signal</span>
                                <span class="font-black text-xl" :class="recommendationClass">{{
                                    technicals?.recommendation
                                    }}</span>
                            </div>
                            <div class="w-full bg-slate-700 h-3 rounded-full overflow-hidden shadow-inner mb-4">
                                <div class="h-full bg-gradient-to-r from-red-500 via-yellow-400 to-green-500 transition-all duration-1000"
                                    :style="{ width: technicals?.score + '%' }"></div>
                            </div>

                            <!-- Signal Reasons -->
                            <div v-if="technicals?.reasons?.length" class="space-y-1">
                                <div v-for="(reason, idx) in technicals.reasons" :key="idx"
                                    class="flex items-start gap-2 text-xs text-slate-300">
                                    <i class="fa-solid fa-check text-emerald-400 mt-0.5"></i>
                                    <span>{{ reason }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 2. Technical Analysis (Top Right) -->
                <div class="lg:col-span-1">
                    <div class="glass-card rounded-2xl p-6 h-full">
                        <h3 class="text-lg font-bold mb-4 text-blue-300 border-l-4 border-blue-500 pl-3">Technical
                            Analysis
                        </h3>

                        <div class="space-y-4 mb-6">
                            <div class="flex justify-between items-center p-3 bg-slate-800/50 rounded-lg">
                                <span class="text-slate-400">RSI (14)</span>
                                <span class="font-mono font-bold"
                                    :class="technicals.indicators.RSI > 70 ? 'text-red-400' : technicals.indicators.RSI < 30 ? 'text-green-400' : 'text-slate-200'">
                                    {{ technicals.indicators.RSI?.toFixed(2) }}
                                </span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-slate-800/50 rounded-lg">
                                <span class="text-slate-400">Stochastic (K/D)</span>
                                <span class="font-mono font-bold text-slate-200">
                                    {{ technicals.indicators.Stochastic_K?.toFixed(1) }} / {{
                                    technicals.indicators.Stochastic_D?.toFixed(1) }}
                                </span>
                            </div>
                        </div>

                        <!-- Granular Trend Table -->
                        <div v-if="technicals.trend_details" class="mb-6">
                            <h4 class="text-xs font-bold text-slate-500 uppercase mb-2">Trend Breakdown (Price vs MA)
                            </h4>
                            <div class="text-xs space-y-1">
                                <div v-for="(data, ma) in technicals.trend_details" :key="ma"
                                    class="flex justify-between items-center p-2 rounded bg-slate-800/30">
                                    <span class="font-mono text-slate-400">{{ ma.replace('_', ' ') }}</span>
                                    <div class="flex items-center gap-2">
                                        <span class="font-mono text-slate-500">{{ formatNumber(data.value) }}</span>
                                        <span class="font-bold px-2 py-0.5 rounded text-[10px]"
                                            :class="data.status === 'Above' ? 'bg-green-500/20 text-green-400' : 'bg-red-500/20 text-red-400'">
                                            {{ data.status.toUpperCase() }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Market Trend Analysis -->
                        <div class="mt-6 p-4 rounded-xl bg-slate-800/50 border border-slate-700">
                            <h4 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-3">Market Trend
                                Phase</h4>
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-full flex items-center justify-center text-2xl shadow-lg"
                                    :class="{
                                        'bg-emerald-500/20 text-emerald-400 ring-2 ring-emerald-500/20': technicals.patterns.trend === 'Bullish',
                                        'bg-rose-500/20 text-rose-400 ring-2 ring-rose-500/20': technicals.patterns.trend === 'Bearish',
                                        'bg-cyan-500/20 text-cyan-400 ring-2 ring-cyan-500/20': technicals.patterns.trend === 'Accumulation',
                                        'bg-orange-500/20 text-orange-400 ring-2 ring-orange-500/20': technicals.patterns.trend === 'Distribution',
                                        'bg-slate-500/20 text-slate-400 ring-2 ring-slate-500/20': technicals.patterns.trend === 'Neutral'
                                    }">
                                    <i v-if="technicals.patterns.trend === 'Bullish'"
                                        class="fa-solid fa-arrow-trend-up"></i>
                                    <i v-else-if="technicals.patterns.trend === 'Bearish'"
                                        class="fa-solid fa-arrow-trend-down"></i>
                                    <i v-else-if="technicals.patterns.trend === 'Accumulation'"
                                        class="fa-solid fa-basket-shopping"></i>
                                    <i v-else-if="technicals.patterns.trend === 'Distribution'"
                                        class="fa-solid fa-box-open"></i>
                                    <i v-else class="fa-solid fa-minus"></i>
                                </div>
                                <div>
                                    <div class="text-xl font-black tracking-tight" :class="{
                                            'text-emerald-400': technicals.patterns.trend === 'Bullish',
                                            'text-rose-400': technicals.patterns.trend === 'Bearish',
                                            'text-cyan-400': technicals.patterns.trend === 'Accumulation',
                                            'text-orange-400': technicals.patterns.trend === 'Distribution',
                                            'text-slate-400': technicals.patterns.trend === 'Neutral'
                                        }">
                                        {{ technicals.patterns.trend }}
                                    </div>
                                    <p class="text-xs text-slate-500 mt-1 font-medium">
                                        <span v-if="technicals.patterns.trend === 'Bullish'">Strong Upward
                                            Momentum</span>
                                        <span v-else-if="technicals.patterns.trend === 'Bearish'">Strong Downward
                                            Pressure</span>
                                        <span v-else-if="technicals.patterns.trend === 'Accumulation'">Potential
                                            Bottoming / Buying Zone</span>
                                        <span v-else-if="technicals.patterns.trend === 'Distribution'">Potential Topping
                                            / Selling Zone</span>
                                        <span v-else>No Clear Trend Direction</span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 3. Right Column: Tabs (Chart, Fundamentals, About) - MOVED TO BOTTOM FULL WIDTH -->
                <div class="lg:col-span-2 space-y-6">

                    <div class="glass-card rounded-2xl p-1 overflow-hidden">
                        <div class="flex border-b border-slate-700/50 bg-slate-800/30 overflow-x-auto">
                            <button @click="activeTab = 'chart'"
                                :class="{'bg-slate-700/50 text-blue-400 border-b-2 border-blue-400': activeTab === 'chart'}"
                                class="flex-1 py-4 px-4 font-bold transition-all hover:bg-slate-700/30 whitespace-nowrap">
                                <i class="fa-solid fa-chart-line mr-2"></i> Chart
                            </button>
                            <button @click="activeTab = 'forecasting'"
                                :class="{'bg-slate-700/50 text-blue-400 border-b-2 border-blue-400': activeTab === 'forecasting'}"
                                class="flex-1 py-4 px-4 font-bold transition-all hover:bg-slate-700/30 whitespace-nowrap">
                                <i class="fa-solid fa-wand-magic-sparkles mr-2"></i> Forecasting
                            </button>
                            <button @click="activeTab = 'seasonal'"
                                :class="{'bg-slate-700/50 text-blue-400 border-b-2 border-blue-400': activeTab === 'seasonal'}"
                                class="flex-1 py-4 px-4 font-bold transition-all hover:bg-slate-700/30 whitespace-nowrap">
                                <i class="fa-solid fa-calendar-alt mr-2"></i> Seasonal
                            </button>
                            <button @click="activeTab = 'fundamentals'"
                                :class="{'bg-slate-700/50 text-blue-400 border-b-2 border-blue-400': activeTab === 'fundamentals'}"
                                class="flex-1 py-4 px-4 font-bold transition-all hover:bg-slate-700/30 whitespace-nowrap">
                                <i class="fa-solid fa-table mr-2"></i> Fundamentals
                            </button>
                            <button @click="activeTab = 'about'"
                                :class="{'bg-slate-700/50 text-blue-400 border-b-2 border-blue-400': activeTab === 'about'}"
                                class="flex-1 py-4 px-4 font-bold transition-all hover:bg-slate-700/30 whitespace-nowrap">
                                <i class="fa-solid fa-info-circle mr-2"></i> About
                            </button>
                        </div>

                        <div class="p-4 min-h-[450px]">
                            <!-- Chart Tab -->
                            <div v-show="activeTab === 'chart'" class="h-full">
                                <!-- Timeframe Controls -->
                                <div class="flex justify-end gap-2 mb-4">
                                    <button @click="changeTimeframe('1mo')"
                                        :class="activeTimeframe === '1mo' ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/30' : 'bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-white'"
                                        class="px-3 py-1 text-xs font-bold rounded-lg transition-all duration-200">1M</button>
                                    <button @click="changeTimeframe('3mo')"
                                        :class="activeTimeframe === '3mo' ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/30' : 'bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-white'"
                                        class="px-3 py-1 text-xs font-bold rounded-lg transition-all duration-200">3M</button>
                                    <button @click="changeTimeframe('6mo')"
                                        :class="activeTimeframe === '6mo' ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/30' : 'bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-white'"
                                        class="px-3 py-1 text-xs font-bold rounded-lg transition-all duration-200">6M</button>
                                    <button @click="changeTimeframe('1y')"
                                        :class="activeTimeframe === '1y' ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/30' : 'bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-white'"
                                        class="px-3 py-1 text-xs font-bold rounded-lg transition-all duration-200">1Y</button>
                                    <button @click="changeTimeframe('5y')"
                                        :class="activeTimeframe === '5y' ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/30' : 'bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-white'"
                                        class="px-3 py-1 text-xs font-bold rounded-lg transition-all duration-200">5Y</button>
                                </div>
                                <div class="relative h-[400px] w-full">
                                    <canvas ref="mainChartCanvas"></canvas>
                                </div>
                            </div>

                            <!-- Forecasting Tab -->
                            <div v-show="activeTab === 'forecasting'" class="h-full">
                                <h4 class="text-sm font-bold text-slate-400 uppercase mb-4 text-center">3-Month Price
                                    Projection (Linear Regression)</h4>
                                <div class="relative h-[400px] w-full">
                                    <canvas ref="forecastChartCanvas"></canvas>
                                </div>
                            </div>

                            <!-- Seasonal Tab -->
                            <div v-show="activeTab === 'seasonal'" class="h-full">
                                <h4 class="text-sm font-bold text-slate-400 uppercase mb-4 text-center">Seasonal
                                    Performance
                                    (Last 3 Years)</h4>
                                <div class="relative h-[400px] w-full">
                                    <canvas ref="seasonalChartCanvas"></canvas>
                                </div>
                            </div>

                            <!-- Fundamentals Tab -->
                            <div v-if="activeTab === 'fundamentals'" class="animate-fade-in">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                                    <div class="bg-slate-800/50 border border-slate-700 p-4 rounded-xl text-center">
                                        <p class="text-xs text-slate-400 uppercase tracking-wider mb-1">P/E Ratio</p>
                                        <p class="font-black text-2xl text-white">{{ fundamentals.ratios.PER?.toFixed(2)
                                            ||
                                            '-' }}</p>
                                    </div>
                                    <div class="bg-slate-800/50 border border-slate-700 p-4 rounded-xl text-center">
                                        <p class="text-xs text-slate-400 uppercase tracking-wider mb-1">P/B Ratio</p>
                                        <p class="font-black text-2xl text-white">{{ fundamentals.ratios.PBV?.toFixed(2)
                                            ||
                                            '-' }}</p>
                                    </div>
                                    <div class="bg-slate-800/50 border border-slate-700 p-4 rounded-xl text-center">
                                        <p class="text-xs text-slate-400 uppercase tracking-wider mb-1">Market Cap</p>
                                        <p class="font-black text-2xl text-emerald-400">{{
                                            formatCompactNumber(fundamentals.ratios.MarketCap) }}</p>
                                    </div>
                                </div>

                                <h4 class="font-bold text-lg mb-4 text-slate-300">Quarterly Financials (Last 2 Years)
                                </h4>
                                <div class="overflow-x-auto rounded-xl border border-slate-700">
                                    <table class="w-full text-sm text-left">
                                        <thead class="text-xs text-slate-400 uppercase bg-slate-800">
                                            <tr>
                                                <th class="px-6 py-4 font-bold">Period</th>
                                                <th class="px-6 py-4 font-bold text-right">Revenue</th>
                                                <th class="px-6 py-4 font-bold text-right">Net Income</th>
                                                <th class="px-6 py-4 font-bold text-right">Op. Expenses</th>
                                            </tr>
                                        </thead>
                                        <tbody class="divide-y divide-slate-700/50">
                                            <tr v-for="q in fundamentals.financials" :key="q.date"
                                                class="bg-slate-800/20 hover:bg-slate-800/50 transition-colors">
                                                <td class="px-6 py-4 font-medium text-slate-300">{{ q.date }}</td>
                                                <td class="px-6 py-4 text-right text-emerald-400 font-mono">{{
                                                    formatCompactNumber(q.revenue) }}</td>
                                                <td class="px-6 py-4 text-right text-blue-400 font-mono">{{
                                                    formatCompactNumber(q.net_income) }}</td>
                                                <td class="px-6 py-4 text-right text-slate-400 font-mono">{{
                                                    formatCompactNumber(q.operating_expense) }}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- About Tab -->
                            <div v-if="activeTab === 'about'" class="animate-fade-in p-2">
                                <div class="prose prose-invert max-w-none">
                                    <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                                        <span class="p-2 bg-blue-500/20 rounded-lg text-blue-400"><i
                                                class="fa-solid fa-building"></i></span>
                                        Company Profile
                                    </h3>
                                    <div class="grid grid-cols-2 gap-6 mb-8 text-sm">
                                        <div>
                                            <span class="text-slate-500 block">Sector</span>
                                            <span class="font-semibold text-slate-200">{{ stockDetails.sector }}</span>
                                        </div>
                                        <div>
                                            <span class="text-slate-500 block">Industry</span>
                                            <span class="font-semibold text-slate-200">{{ stockDetails.industry
                                                }}</span>
                                        </div>
                                    </div>
                                    <p
                                        class="text-slate-300 leading-relaxed text-base bg-slate-800/30 p-6 rounded-2xl border border-slate-700/50">
                                        {{ stockDetails.description || 'No description available for this stock.' }}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
    </div>

    <!-- App Logic -->
    <script src="/static/app.js"></script>
</body>

</html>